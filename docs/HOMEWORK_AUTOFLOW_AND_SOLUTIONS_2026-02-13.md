# Домашка + финализация автофлоу (черновик для оператора)

Дата по скриншоту: **пятница, 13.02**.

## 1) Решение домашки (что удалось закрыть по доступным материалам)

Источник с заданиями: скрин расписания/домашки.

### Русский язык
- Подготовка к самостоятельной работе.
- Выучить правила по деепричастию.

Краткая памятка:
- Деепричастие обозначает добавочное действие при основном действии сказуемого.
- Отвечает на вопросы: «что делая?», «что сделав?».
- С деепричастным оборотом почти всегда ставится запятая.
- Не употребляется, если добавочное действие не относится к подлежащему.

### Алгебра
По `books/alg.pdf` найдены упражнения **№444** и **№451**.

#### Пункт 20 (что выучить)
Раздел про степень с натуральным показателем и свойства степеней:
1. 
\[(ab)^n = a^n b^n\]
2. 
\[(a^m)^n = a^{mn}\]
3. При чётной степени знак минуса исчезает, при нечётной — сохраняется.

#### №444. Возведите в степень
а) \((mn)^5 = m^5n^5\)

б) \((xyz)^2 = x^2y^2z^2\)

в) \((-3y)^4 = 81y^4\)

г) \((-2ax)^3 = -8a^3x^3\)

д) \((10xy)^2 = 100x^2y^2\)

е) \((-2abx)^4 = 16a^4b^4x^4\)

ж) \((-am)^3 = -a^3m^3\)

з) \((-xn)^4 = x^4n^4\)

#### №451. Представьте в виде степени произведение
а) \(b^3x^3 = (bx)^3\)

б) \(a^7y^7 = (ay)^7\)

в) \(x^2y^2z^2 = (xyz)^2\)

г) \((-a)^3b^3 = (-ab)^3\)

д) \(2^5a^5 = (2a)^5\)

е) \(0{,}027m^3 = (0{,}3m)^3\), т.к. \(0{,}027 = 0{,}3^3\).

### Вероятность и статистика
На скрине: читать стр. 48–49, знать ответы на вопросы стр. 50, №87 и №88 (стр. 50).

Статус: нужен конкретный учебник по вероятности/статистике (файл PDF или фото страниц 48–50), т.к. в доступном `alg.pdf` на стр. 50 другие задания.

### Английский
По скрину:
1) повторить THG (часть 6), слова модуль 7;
2) стр. 71 №1 устно, стр. 71 №2 прослушать запись и записать пропуски + перевод устно;
3) ДЗ: стр. 72 №2 чтение + перевод устно.

Статус: для полного решения нужны фото/сканы страниц 71–72 и текст аудио 73.mp3.

### Труд (технология)
Задание: написать сообщение о профессии, связанной с производством одежды.

Готовый вариант:

> **Профессия: технолог швейного производства**  
> Технолог швейного производства — это специалист, который организует процесс создания одежды на фабрике. Он выбирает материалы, контролирует качество ткани и швов, следит за соблюдением технологии пошива. Технолог помогает сделать так, чтобы одежда была удобной, красивой и прочной. Он работает вместе с конструкторами, закройщиками и швеями, чтобы готовое изделие соответствовало модели и размерам. Эта профессия важна, потому что от неё зависит качество одежды, которую носят люди каждый день.

---

## 2) Как финализировать полный автоматический флоу (90% уже готово)

Ниже — практичный чеклист для доведения Telegram `/codex` -> Slack -> PR -> callback до стабильного «почти без ручных действий» режима.

### Текущее состояние (уже есть)
- Есть API callback: `POST /api/codex-bridge/callback` с `x-codex-bridge-secret`.
- Есть локальный helper: `scripts/codex-notify.mjs`.
- Есть документированный payload-контракт с `status/summary/branch/taskPath/prUrl`.
- Есть правила branch->preview slug (`/` -> `-`).

### Что нужно закрыть, чтобы считать flow «полностью готовым»

#### A. Авто-коллбек сразу после PR (критично)
1. После создания PR всегда брать **реальный branch** из PR metadata (`head.ref`).
2. Сразу отправлять callback со статусом `completed` или `pr_opened`.
3. Если нет секрета/target-полей — печатать fallback curl в ответе.

#### B. Единый lifecycle статусов
Добавить поддержку статусов:
- `started`
- `checks_passed`
- `pr_opened`
- `completed`
- `failed`

Это даст прозрачный трекинг в Slack/Telegram-треде.

#### C. Idempotency + аудит
1. Добавить idempotency key в callback payload.
2. Логировать события в таблицу `codex_bridge_events` (время, статус, branch, prUrl, targets, error).
3. При повторной отправке не дублировать сообщения в каналах.

#### D. Preview health signal
1. После PR вычислять preview URL из финального branch.
2. Проверять health endpoint (или хотя бы HTTP status).
3. Добавлять в callback кратко: `preview: up/down/booting`.

#### E. Маршрутизация уведомлений
- Для `/codex` задач передавать, когда есть:
  - `telegramChatId`
  - `telegramUserId`
  - `slackChannelId`
  - `slackThreadTs`
- В webhook-режиме Slack можно оставить только webhook без channel id.

### Рекомендуемый DoD (definition of done) для bridge-задач
Задача считается завершённой только если:
1. Изменения закоммичены.
2. PR создан.
3. Callback отправлен автоматически **или** приложен валидный fallback curl.
4. В callback есть корректные `branch` и `prUrl`.
5. Есть preview link, рассчитанный из реального branch.

### Минимальный payload-шаблон
```json
{
  "status": "completed",
  "summary": "Короткий итог + next action",
  "branch": "real-branch-from-pr",
  "taskPath": "/",
  "prUrl": "https://github.com/.../pull/...",
  "telegramChatId": "...",
  "telegramUserId": "...",
  "slackChannelId": "...",
  "slackThreadTs": "..."
}
```

### Fallback curl (если авто-отправка недоступна)
```bash
curl -X POST "https://v0-car-test.vercel.app/api/codex-bridge/callback" \
  -H "Content-Type: application/json" \
  -H "x-codex-bridge-secret: $CODEX_BRIDGE_CALLBACK_SECRET" \
  -d '{
    "status": "completed",
    "summary": "PR создан, проверь preview",
    "branch": "<real-current-branch>",
    "taskPath": "/",
    "prUrl": "<pr-url>",
    "telegramChatId": "<optional>",
    "telegramUserId": "<optional>",
    "slackChannelId": "<optional>",
    "slackThreadTs": "<optional>"
  }'
```

### Быстрый финальный roadmap (коротко)
1. Закрыть авто-коллбек на каждом PR.
2. Добавить lifecycle + idempotency.
3. Подключить логи callback-событий в Supabase.
4. Добавить проверку preview health.
5. Обновить runbook для операторов (1 страница + примеры ошибок/ретраев).

После этих 5 шагов flow можно считать production-ready для ежедневного использования.
